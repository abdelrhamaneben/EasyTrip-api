<!DOCTYPE html>
<html lang="en">
<head>
    <title>EasyTrip</title>
    <meta charset="utf8" />
    <!-- Bootstrap Core CSS -->
    <link href="styles/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="styles/font-awesome.min.css" rel="stylesheet">
    <link href="styles/result.css" rel="stylesheet">
    <link href="styles/animate.css" rel="stylesheet">
    
    <!--    Jquery-->
    <link href="styles/jquery-ui-1.9.2.custom.min.css" rel="stylesheet"> 
    
    <!--    Bootstrap dialog-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/css/bootstrap-dialog.min.css">
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
</head>
<body onload="initialize()">
     
    <header class="text-center">
        <a href="/" style="float:left; color:white;">Change category</a>
        <div id="titre" class="col-md-offset-5">

            <h1 class="text-center">EasyTrip</h1>
        </div>
    </header>
    <!-- APP  -->

    
    <div class="col-md-12" id="app">
       
        <!-- Right part (Filter / Activities bar)  -->
            
        <section id="l-part" class="col-md-2 col-xs-12">
            
            <!--  Filter    -->
            <button type="button" class="btn btn-default" id="showFilter" >Show Filters </button>
            <button type="button" class="btn btn-default" id="hideFilter" >Hide Filters </button>
            <div href="#" id="filters"  class>
                <div class="row">
                    <h5><strong>Price:</strong></h5>
                    <div class="col-xs-5 col-sm-offset-1">
                        <p>Min</p><input type="text" id="priceMin" class="form-control filter">
                    </div>
                    <div class="col-xs-5">
                        <p>Max</p><input type="text" id="priceMax" class="form-control filter">                        
                    </div>
                </div>                    
                <div class="row">
                    <h5><strong>Capacity:</strong></h5>
                    <div class="col-xs-6 col-sm-offset-1">
                      <input class="form-control filter" id="capacity" type="text">
                    </div>
                </div>
                <div class="row">
                    <h5><strong>Service:</strong></h5>
                    <div class="col-xs-9 col-sm-offset-1">
                      <input class="form-control  filter" id="service" type="text">
                    </div>
                </div>
                <div class="row">
                    <h5><strong>Dates:</strong></h5>
                    <div class="col-xs-7 col-sm-offset-1">
                        <p>From</p><input type="text" id="dateStart" class="form-control filter" onchange="filter()">
                    </div>
                    <div class="col-xs-7 col-sm-offset-1">
                        <p>To</p><input type="text" id="dateEnd" class="form-control filter" onchange="filter()">                        
                    </div>
                </div>                
                <hr>
            </div>
            
            <!--  Activities-->
            <div id = "activities" class="animated fadeInLeft">
                <h4>Choose your activities</h4>
                <ul class="list-group" id="list_activities">
                  <!-- List of activities -->
                </ul>
            </div>
            
        </section>
        
        <!-- Center part (List of services) -->      
        <section id="c-part"class="col-md-5 col-xs-12" style="overflow-y : scroll;height:100%;">
            
        </section>
        <!-- Left part (Google map)  -->
        <section id="r-part"class="col-md-5 col-xs-12">
           <div id="map_canvas"></div>
        </section>
    </div>
    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!--    DatePicker-->
    <script src="js/jquery-ui-1.9.2.custom.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Controller JS -->
    <script src="js/models/service.js"></script>
    <script src="js/models/map_manager.js"></script>
    <script src="js/models/activities_manager.js"></script>
    <script src="js/models/services_manager.js"></script>

    <!-- APP -->    
    <script type="text/javascript"> 
        //Bootstrap dialog
        $('#showPopup').click(function(){
            BootstrapDialog.show({
                title: 'Rank service',
                /*message: function(dialog) {
                    var $content = services_manager.popup(1);
                    return $content;
                },*/
                message: 'Hi Apple!',
                buttons: [{
                    cssClass: 'btn-primary',
                    label: 'Save',
                    action: function(dialog) {
                        dialog.close();
                    }
                }]
            });
        });
        
        //------ FILTERS
        $('#showFilter').hide();
        
        var animationIn = 'animated fadeInLeft';
        var animationOut = 'animated fadeOutLeft';
        var animationUp = 'bounceInUp';
        var animationEnd = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
        
        $('.filter').keyup(function(){
            services_manager.build();
        });
                
        $('#showFilter').click(function (){            
            $('#filters').addClass(animationIn).one(animationEnd,function(){ $(this).removeClass(animationIn);});
            $('#filters').show();
            $('#showFilter').hide();
            $('#hideFilter').show();            
        });
        
        $('#hideFilter').click(function (){
            $('#filters').addClass(animationOut).one(animationEnd,
                function(){ 
                    $(this).removeClass(animationOut);
                    $('#filters').hide();
                    $('#activities').removeClass(animationIn);
                    $('#activities').addClass(animationUp);
                $('#hideFilter').hide();
            $('#showFilter').show();
                    
            });       
        });
        
         //Dates
       $( "#dateStart" ).datepicker({
            minDate: 0,
            onSelect: function (dateText, inst) {
                var date = $.datepicker.parseDate($.datepicker._defaults.dateFormat, dateText);
                $("#dateEnd").datepicker("option", "minDate", date);
                services_manager.build();
            }
        });
        $( "#dateEnd" ).datepicker({
            onSelect: function(){
                services_manager.build();
            }            
        });
        
        
       function initialize() {    
           
            // ----------------  Initialize Services ----------------- (Service Controller)
            services_manager.load(null,[]);
            /*services_manager.onClickService = function (service) {
                map_manager.displayService(service);
            };*/
            // ----------- initialize Google Map and add marker  ------- (Map Controller)
            map_manager.init(0,0);
            map_manager.loadMarker(services_manager.data);
            map_manager.resize();

            map_manager.onMapChanged(function () {
                reload();
            });

            // define action Click on Marker map
            map_manager.clickOnMarker = function (service) { 
                $('.part h3').css('color','#333');
                $('#service_' + service.id_service + ' h3').css('color','#AF2A47');
            };

            // -------------  initialize List of Activities  --------- (Activities Controller)
            activities_manager.clickOnActivity = function (id) {
                reload();
                $('.card').hide(350).show(300);

            };

            activities_manager.load();

            function reload() {
                var activities = activities_manager.getActivities();
                var restangle = map_manager.getRectangle();
                // NEED SEARCH 
                services_manager.load(restangle,activities);
                map_manager.loadMarker(services_manager.data);
            }           
        }
            
        
    </script>
</body>

</html>
